## 1. 개요 
JWT를 이용한 인증 방법 구현하기 위해 공부한 내용.

## 2. 개념 
암호화된 Json 형식의 토큰을 의미한다. 주로 인증에 사용한다. HMAC알고리즘이나 공개키, 비밀키를 통해 암호화가 진행된다. 

### 2.1 구조 
- Header, Payload, Signature로 구분된다. 

#### 2.1.1 Header
2가지 정보가 들어간다. 토큰의 타입과 암호화 시 사용되는 알고리즘이 전달된다. 

```
{
  "alg": "HS256",
  "typ": "JWT"
}
```

#### 2.1.2 PayLoad 
전달되는 데이터를 의미한다. JWT에서는 Claims라고 부른다. PayLoad의 종류는 public, Registered, Private으로 나눠진다. 각 종류는 추후에 살펴보자. 

```shell script
{
  "userId" : "sunny",
  "name": "sunny",
}
```

#### 2.1.3 Signature
JWT에 대한 유효성을 보증하는 서명?이다. 인코딩된 header와 payload, 사용된 alogorithm이 함께 담아서 넘어온다. 

```shell script
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
``` 

### 2.1.4 암호화된 JWT 결과
- 위 내용을 암호화하면 아래 결과로 바뀐다.

```java
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJzdW5ueSIsIm5hbWUiOiJzdW5ueSJ9.D9f3jiQ3fXdk-xdRGqXzmf3ynnhKjGe5xs2MKTGptFc
```


## 3. JWT 사용법
### 3.1 이번 프로젝트에서 jwt가 사용되는 순서
- 처음 로그인할 때 클라이언트는 Post로 id와 password를 보낸다. 
- 서버는 id와 password 유효성을 확인하고 userId를 담은 JWT를 만든다.
- 서버는 만들어진 jwt를 쿠키에 담아서 클라이언트에 전달한다.
- 이후 모든 클라이언트 요청에 JWT가 담아서 온다. 
- 서버는 인터셉터에서 클라이언트 요청에 넘어오는 JWT가 유효한지 확인한다. 
    - 유효하다면 클라이언트 요청에 응답한다. 
    - 만약 유효하지 않다면 컨트롤러에서 401(Unauthorized) 상태코드를 반환한다. 

### 3.2 스프링에서 JWT 토큰으로 만드는 법, jjwt 사용법
#### 3.2.1 jwt 의존성 추가  

```shell script
// https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt
compile group: 'io.jsonwebtoken', name: 'jjwt', version: '0.9.1'
```

#### 3.2.2 JWT 토큰을 만드는 법

```java
@GetMapping("/hello")  
public String hello() {  
  String key = "A";  
  Map<String, Object> headers = new HashMap<>();  
  headers.put("typ", "JWT");  
  headers.put("alg", "HS256");  
  
  String userId = "sunny";  
  Map<String, Object> payloads = new HashMap<>();  
  payloads.put("userId", userId);  
  
  jwt = Jwts.builder()  
 .setHeader(headers)  
 .setClaims(payloads)  
 .signWith(SignatureAlgorithm.HS256, key.getBytes())  
 .compact();  
  
  return jwt;  
}
``` 

- 결과 

```shell script
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1ODY0MDg3ODQ4ODUsInVzZXJJZCI6Imd1c3duczE2NTkifQ.KoUzMWGMI-FxBqHtdNvoxLBFton_tZXtQKejRfMuitc
```

### 3.2.3 JWT 토큰을 Parsing하는 법 (암호를 다시 푸는 법)

```java
@GetMapping("jwtParsing")  
public String jwtParsing() {  
  Claims claims = Jwts.parser()  
 .setSigningKey("A".getBytes())  
 .parseClaimsJws(jwt)  
 .getBody();  
  return claims.get("userId", String.class);  
}
```

- 결과

```shell script
return 값 : sunny
```

## 4. Session과 차이점 
### 4.1 session
- Session에 정보가 많으면 메모리를 많이 잡아먹는다. 
- 서버에서 Session을 관리하기 때문에 세션 저장소를 유지해야 한다. 세션이 많아질수록 저장소가 많아지기 때문에 서버의 부담이 늘어간다.
### 4.2 차이점 
session은 서버에 세션 정보를 저장하지만 jwt는 브라우저가 가지고 있어서 매번 요청한다.

